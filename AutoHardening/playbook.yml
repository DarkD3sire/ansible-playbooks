#########################################################
# Auto Server Haredening Script
#########################################################
---
- hosts: all
  become: true
  vars_files:
    - vars/default.yml

  tasks:
    - name: Update & upgrade apt packges
      apt: 
        force_apt_get: yes
        upgrade: yes
        update_cache: yes
        cache_valid_time: 86400 #One day
      tags: [ system ]

    - name: Install firewalld
      action: apt name=firewalld state=latest

    - name: Enable firewalld on system reboot
      service: name=firewalld enabled=yes

    - name: Start Firewalld
      service: 
        name: firewalld
        state: started

    - name: Add ports
      firewalld:
        permanent: yes
        immediate: yes
        service: "{{item}}"
      with_items:
       - http
       - https
       - ssh

#    - name: Add ports
#      firewalld:
#        permanent: yes
#        immediate: yes
#        port: "{{item.port}}/{{item.proto}}"
#        state: "{{item.state}}"
#        zone: "{{item.zone}}"
#      with_items:
#       - {port: "80", proto: "tcp", state: "enabled", zone: "public" }
#       - {port: "443", proto: "tcp", state: "enabled", zone: "public" }
#       - {port: "10050", proto: "tcp", state: "enabled", zone: "internal" }











